window.CCounter = 0;
CKEDITOR.dialog.add("eqneditorDialog", function(e) {
    var t = "https:" == document.location.protocol ? "https://" : "http://";
    window.CCounter++;
    return {
        title: e.lang.eqneditor.title,
        minWidth: 550,
        minHeight: 380,
        resizable: CKEDITOR.DIALOG_RESIZE_NONE,
        contents: [{
            id: "CCEquationEditor",
            label: "EqnEditor",
            elements: [{
                type: "html",
                html: '<div id="CCtoolbar' + window.CCounter + '"></div>',
                style: "margin-top:-9px"
            }, {
                type: "html",
                html: '<label for="CClatex' + window.CCounter + '">Equation (LaTeX):</label>'
            }, {
                type: "html",
                html: '<textarea id="CClatex' + window.CCounter + '" rows="5"></textarea>',
                style: "border:1px solid #8fb6bd; width:540px; font-size:16px; padding:5px; background-color:#ffc"
            }, {
                type: "html",
                html: '<label for="CCequation' + window.CCounter + '">Preview:</label>'
            }, {
                type: "html",
                html: '<div style="position:absolute; left:5px; bottom:0; z-index:999"></div><img id="CCequation' + window.CCounter + '" src="' + t + 'www.codecogs.com/images/spacer.gif" />'
            }]
        }],
        onLoad: function() {
            EqEditor.embed("CCtoolbar" + window.CCounter, "", "efull");
            EqEditor.add(new EqTextArea("CCequation" + window.CCounter, "CClatex" + window.CCounter), false)
        },
        onShow: function() {
            var t = this,
                n = e.getSelection(),
                r = n.getStartElement().getAscendant("img", true);
            if (r) {
                var i = r.getAttribute("src").match(/(gif|svg)\.latex\?(.*)/);
                if (i != null) EqEditor.getTextArea().setText(i[2]);
                t.insertMode = true
            }
            t.setupContent(t.image)
        },
        onOk: function() {
            var t = e.document.createElement("img");
            t.setAttribute("alt", EqEditor.getTextArea().getLaTeX());
            t.setAttribute("src", EqEditor.getTextArea().exportEquation("urlencoded"));
            e.insertElement(t)
        }
    }
})